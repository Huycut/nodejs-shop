<!--câu lệnh xuống dòng-->
<style>
	.description {
		white-space: pre-wrap;
	}
</style>

<body>

	<!-- Start Header Area -->
	<%- include('../header')%>
		<!-- End Header Area -->

		<!-- Start Banner Area -->
		<section class="banner-area organic-breadcrumb">
			<div class="container">
				<div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
					<div class="col-first">
						<h1>Product Details Page</h1>
						<nav class="d-flex align-items-center">
							<a href="index.html">Home<span class="lnr lnr-arrow-right"></span></a>
							<a href="#">Shop<span class="lnr lnr-arrow-right"></span></a>
							<a href="single-product.html">product-details</a>
						</nav>
					</div>
				</div>
			</div>
		</section>
		<!-- End Banner Area -->

		<!--================Single Product Area =================-->

		<div class="product_image_area">
			<div class="container">
				<div class="row s_product_inner">
					<div class="col-lg-6">
						<div class="">
							<div class="single-prd-item">
								<img class="img-fluid" src=<%- prd.ImgPrd%> alt="">
							</div>
						</div>
					</div>
					<div class="col-lg-5 offset-lg-1">
						<div class="s_product_text">
							<h3><%- prd.NamePrd%></h3>
							<h2 class="productPrice"><%- prd.PricePrd%></h2>
							<ul class="list">
								<li><a class="active" href="#"><span>Category</span> : Household</a></li>
								<li><a href="#"><span>Availibility</span> : In Stock</a></li>
							</ul>
							<p>Mill Oil is an innovative oil filled radiator with the most modern technology. If you are
								looking for
								something that can make your interior look awesome, and at the same time give you the
								pleasant warm feeling
								during the winter.</p>
							<div class="product_count">
								<!-- <label for="qty">Quantity:</label>
							<input type="text" name="qty" id="sst" maxlength="12" value="1" title="Quantity:" class="input-text qty">
							<button onclick="var result = document.getElementById('sst'); var sst = result.value; if( !isNaN( sst )) result.value++;return false;"
							 class="increase items-count" type="button"><i class="lnr lnr-chevron-up"></i></button>
							<button onclick="var result = document.getElementById('sst'); var sst = result.value; if( !isNaN( sst ) &amp;&amp; sst > 0 ) result.value--;return false;"
							 class="reduced items-count" type="button"><i class="lnr lnr-chevron-down"></i></button> -->
							</div>
							<div class="card_area d-flex align-items-center">
								<button class="primary-btn" type="button" onclick="addToCart('<%- prd.IDPrd%>')">Thêm
									vào giỏ hàng</button>
								<a class="icon_btn" href="#"><i class="lnr lnr lnr-diamond"></i></a>
								<a class="icon_btn" href="#"><i class="lnr lnr lnr-heart"></i></a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--================End Single Product Area =================-->

		<!--================Product Description Area =================-->
		<section class="product_description_area">
			<div class="container">
				<ul class="nav nav-tabs" id="myTab" role="tablist">
					<li class="nav-item">
						<a class="nav-link" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home"
							aria-selected="true">Mô Tả</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
							aria-controls="profile" aria-selected="false">Bảng Size</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" id="review-tab" data-toggle="tab" href="#review" role="tab"
							aria-controls="review" aria-selected="false">Bình luận & Đánh giá</a>
					</li>
				</ul>
				<div class="tab-content" id="myTabContent">
					<div class="tab-pane fade" id="home" role="tabpanel" aria-labelledby="home-tab">
						<p class="description">
							<%= prd.TitlePrd%>
						</p>
					</div>
					<div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
						<div class="table-responsive">
							<table class="table">
								<tbody>
									<tr>
										<td>
											<h5>Width</h5>
										</td>
										<td>
											<h5>128mm</h5>
										</td>
									</tr>
									<tr>
										<td>
											<h5>Height</h5>
										</td>
										<td>
											<h5>508mm</h5>
										</td>
									</tr>
									<tr>
										<td>
											<h5>Depth</h5>
										</td>
										<td>
											<h5>85mm</h5>
										</td>
									</tr>
									<tr>
										<td>
											<h5>Weight</h5>
										</td>
										<td>
											<h5>52gm</h5>
										</td>
									</tr>
									<tr>
										<td>
											<h5>Quality checking</h5>
										</td>
										<td>
											<h5>yes</h5>
										</td>
									</tr>
									<tr>
										<td>
											<h5>Freshness Duration</h5>
										</td>
										<td>
											<h5>03days</h5>
										</td>
									</tr>
									<tr>
										<td>
											<h5>When packeting</h5>
										</td>
										<td>
											<h5>Without touch of hand</h5>
										</td>
									</tr>
									<tr>
										<td>
											<h5>Each Box contains</h5>
										</td>
										<td>
											<h5>60pcs</h5>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div class="tab-pane fade show active" id="review" role="tabpanel" aria-labelledby="review-tab">
						<div class="row">
							<div class="col-lg-6">
								<div class="row total_rate">
									<div class="col-6">
										<div class="box_total">
											<h5>Tổng Điểm</h5>
											<h4><%- averageRating%></h4>
											<h6>(dựa trên <%- totalReviews%> đánh giá)</h6>
										</div>
									</div>
									<div class="col-6">
										<div class="rating_list">
											<h3>Based on 3 Reviews</h3>
											<ul class="list">
												<li><a href="#">5 Sao <i class="fa fa-star"></i><i
															class="fa fa-star"></i><i class="fa fa-star"></i><i
															class="fa fa-star"></i><i class="fa fa-star"></i> <%-
															rating['5stars'] %></a>
												</li>
												<li><a href="#">4 Sao <i class="fa fa-star"></i><i
															class="fa fa-star"></i><i class="fa fa-star"></i><i
															class="fa fa-star"></i><i class="fa fa-star"></i> <%-
															rating['4stars'] %></a>
												</li>
												<li><a href="#">3 Sao <i class="fa fa-star"></i><i
															class="fa fa-star"></i><i class="fa fa-star"></i><i
															class="fa fa-star"></i><i class="fa fa-star"></i> <%-
															rating['3stars'] %></a>
												</li>
												<li><a href="#">2 Sao <i class="fa fa-star"></i><i
															class="fa fa-star"></i><i class="fa fa-star"></i><i
															class="fa fa-star"></i><i class="fa fa-star"></i> <%-
															rating['2stars'] %></a>
												</li>
												<li><a href="#">1 Sao <i class="fa fa-star"></i><i
															class="fa fa-star"></i><i class="fa fa-star"></i><i
															class="fa fa-star"></i><i class="fa fa-star"></i> <%-
															rating['1stars'] %></a>
												</li>
											</ul>
										</div>
									</div>
								</div>
								<div class="review_list">
									<% reviewPrd.forEach(function(valueReview){%>
										<div class="review_item">
											<div class="media">
												<div class="d-flex">
													<img src="img/product/review.jpg" alt="" style="width: 60px;">
												</div>
												<div class="media-body">
													<h4><%- valueReview.Name%></h4>
													<% for(let i=valueReview.Rating; i> 0; i--) { %>
														<i class="fa fa-star"></i>
														<% } %>
												</div>
											</div>
											<p><%- valueReview.Comment%></p>
										</div>
										<%});%>

								</div>
							</div>
							<div class="col-lg-6">
								<div class="review_box">
									<h4>Đánh Giá Sản Phẩm</h4>
									<p>Đánh Giá Sao:</p>
									<ul class="list">
										<li><span class="fa fa-star star-transparent" data-index="1"></span></li>
										<li><span class="fa fa-star star-transparent" data-index="2"></span></li>
										<li><span class="fa fa-star star-transparent" data-index="3"></span></li>
										<li><span class="fa fa-star star-transparent" data-index="4"></span></li>
										<li><span class="fa fa-star star-transparent" data-index="5"></span></li>
									</ul>
									<form class="row contact_form" id="reviewForm" action="" method="post"
										id="contactForm" novalidate="novalidate">
										<div class="col-md-12">
											<div class="form-group">
												<textarea class="form-control" name="message" id="message" rows="1"
													placeholder="Review" onfocus="this.placeholder = ''"
													onblur="this.placeholder = 'Review'"></textarea></textarea>
											</div>
										</div>
										<div class="col-md-12 text-right">
											<button type="submit" value="submit" class="primary-btn">Submit Now</button>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!--================End Product Description Area =================-->

		<!-- Start related-product Area -->
		<section class="related-product-area section_gap_bottom">
			<div class="container">
				<div class="row justify-content-center">
					<div class="col-lg-6 text-center">
						<div class="section-title">
							<h1>Ưu đãi trong tuần</h1>

						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-lg-9">
						<div class="row">
						<% salePrd.forEach(function(value){%>
							<div class="col-lg-4 col-md-4 col-sm-6 mb-20">
								<div class="single-related-product d-flex">
									<a href="<%- value.MetaPrd%>"><img src="<%- value.ImgPrd%>" alt="" style="width: 100px;"></a>
									<div class="desc">
										<a href="<%- value.MetaPrd%>" class="title"><% const truncatedTextSale=value.NamePrd.length> 25 ?
											value.NamePrd.substring(0, 34) + "..." : value.NamePrd;
											%>
											<%- truncatedTextSale%></a>
										<div class="price" style="display: flex;flex-direction: column;">
											<h6 class ="productPrice"><%- (value.PricePrd - value.SaleOff)%></h6>
											<h6 class="l-through productPrice"><%- value.PricePrd%></h6>
										</div>
									</div>
								</div>
							</div>
						<%});%>	
						</div>
					</div>
					<!-- <div class="col-lg-3">
						<div class="ctg-right">
							<a href="#" target="_blank">
								<img class="img-fluid d-block mx-auto" src="img/category/c5.jpg" alt="">
							</a>
						</div>
					</div> -->
				</div>
			</div>
		</section>
		<!-- End related-product Area -->

		<!-- start footer Area -->
		<%- include('../footer')%>

</body>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		let selectedStars = 0;
		let idPrd = '<%= prd.IDPrd %>';
		// Xử lý sự kiện hover và click cho ngôi sao
		document.querySelectorAll('.star-transparent').forEach((star, index, stars) => {
			star.addEventListener('mouseover', () => {
				stars.forEach((s, i) => {
					s.classList.toggle('hover', i <= index); // Áp dụng lớp hover cho các sao từ đầu đến sao hiện tại
				});
			});

			star.addEventListener('mouseout', () => {
				stars.forEach((s) => {
					s.classList.remove('hover'); // Xóa lớp hover khi chuột rời khỏi ngôi sao
				});
			});

			star.addEventListener('click', () => {
				selectedStars = index + 1; // Lưu số sao đã chọn
				stars.forEach((s, i) => {
					s.classList.toggle('selected', i < selectedStars); // Áp dụng lớp selected cho các sao từ đầu đến sao đã chọn
				});
			});
		});

		// Xử lý sự kiện submit form
		document.getElementById('reviewForm').addEventListener('submit', (event) => {
			event.preventDefault(); // Ngăn không cho form gửi theo cách truyền thống

			// Lấy dữ liệu số sao và bình luận
			const comment = document.getElementById('message').value;

			// Gửi dữ liệu đến server
			fetch('/product/review', { // Đảm bảo URL đúng với router trên server
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ stars: selectedStars, comment: comment, idPrd: idPrd })
			})
				.then(response => response.json())
				.then(data => {
					// Tạo phần tử HTML mới cho review
					const reviewList = document.querySelector('.review_list'); // Phần tử chứa danh sách review
					const newReview = document.createElement('div');
					newReview.classList.add('review_item');

					// Tạo HTML từ dữ liệu trong form
					newReview.innerHTML = `
								<div class="media">
									<div class="d-flex">
										<img src="img/product/review.jpg" alt="" style="width: 60px;">
									</div>
									<div class="media-body">
										<h4>Bạn</h4> <!-- Thay thế bằng tên người dùng thực tế nếu cần -->
										${Array.from({ length: 5 }, (_, i) => i < selectedStars ?
												'<i class="fa fa-star"></i>' : '<i class="fa fa-star-o"></i>'
											).join('')}
									</div>
								</div>
								<p>${comment}</p>
							`;

					// Thêm review mới vào danh sách
					reviewList.prepend(newReview); // Thêm review vào đầu danh sách

					// Xóa nội dung trong trường bình luận và reset selectedStars
					document.getElementById('message').value = '';
					selectedStars = 0;
				})
				.catch(error => console.error('Lỗi:', error));
		});
	});


</script>

</html>